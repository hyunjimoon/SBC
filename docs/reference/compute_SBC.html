<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fit datasets and evaluate diagnostics and SBC metrics. — compute_SBC • SBC</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fit datasets and evaluate diagnostics and SBC metrics. — compute_SBC"><meta property="og:description" content="Performs the main SBC routine given datasets and a backend."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="hyunjimoon.github.io" src="https://plausible.io/js/script.js"></script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SBC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/SBC.html">Get Started</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="http://mc-stan.org/rstan" class="external-link">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr" class="external-link">cmdstanr</a>
    </li>
    <li>
      <a href="http://paul-buerkner.github.io/brms/" class="external-link">brms</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm" class="external-link">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot" class="external-link">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan" class="external-link">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo" class="external-link">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred" class="external-link">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools" class="external-link">rstantools</a>
    </li>
    <li>
      <a href="https://mc-stan.org/posterior" class="external-link">posterior</a>
    </li>
  </ul></li>
<li>
  <a href="http://mc-stan.org" class="external-link">Stan</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://twitter.com/mcmc_stan" class="external-link">
    <span class="fa fa-twitter"></span>

  </a>
</li>
<li>
  <a href="https://github.com/hyunjimoon/SBC" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/" class="external-link">
    <span class="fa fa-users"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit datasets and evaluate diagnostics and SBC metrics.</h1>
    <small class="dont-index">Source: <a href="https://github.com/hyunjimoon/SBC/blob/HEAD/R/results.R" class="external-link"><code>R/results.R</code></a></small>
    <div class="hidden name"><code>compute_SBC.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Performs the main SBC routine given datasets and a backend.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">compute_SBC</span><span class="op">(</span></span>
<span>  <span class="va">datasets</span>,</span>
<span>  <span class="va">backend</span>,</span>
<span>  cores_per_fit <span class="op">=</span> <span class="fu"><a href="default_cores_per_fit.html">default_cores_per_fit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  keep_fits <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  thin_ranks <span class="op">=</span> <span class="fu"><a href="SBC_backend_default_thin_ranks.html">SBC_backend_default_thin_ranks</a></span><span class="op">(</span><span class="va">backend</span><span class="op">)</span>,</span>
<span>  ensure_num_ranks_divisor <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fu"><a href="default_chunk_size.html">default_chunk_size</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  dquants <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cache_mode <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  cache_location <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  globals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  gen_quants <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-datasets">datasets<a class="anchor" aria-label="anchor" href="#arg-datasets"></a></dt>
<dd><p>an object of class <code>SBC_datasets</code></p></dd>


<dt id="arg-backend">backend<a class="anchor" aria-label="anchor" href="#arg-backend"></a></dt>
<dd><p>the model + sampling algorithm. The built-in backends can be constructed
using <code><a href="SBC_backend_cmdstan_sample.html">SBC_backend_cmdstan_sample()</a></code>, <code><a href="SBC_backend_cmdstan_variational.html">SBC_backend_cmdstan_variational()</a></code>,
<code><a href="SBC_backend_rstan_sample.html">SBC_backend_rstan_sample()</a></code>, <code><a href="SBC_backend_rstan_optimizing.html">SBC_backend_rstan_optimizing()</a></code> and <code><a href="SBC_backend_brms.html">SBC_backend_brms()</a></code>.
(more to come: issue 31, 38, 39). The backend is an S3 class supporting at least the <code><a href="SBC_fit.html">SBC_fit()</a></code>,
<code><a href="SBC_fit_to_draws_matrix.html">SBC_fit_to_draws_matrix()</a></code> methods.</p></dd>


<dt id="arg-cores-per-fit">cores_per_fit<a class="anchor" aria-label="anchor" href="#arg-cores-per-fit"></a></dt>
<dd><p>how many cores should the backend be allowed to use for a single fit?
Defaults to the maximum number that does not produce more parallel chains
than you have cores. See <code><a href="default_cores_per_fit.html">default_cores_per_fit()</a></code>.</p></dd>


<dt id="arg-keep-fits">keep_fits<a class="anchor" aria-label="anchor" href="#arg-keep-fits"></a></dt>
<dd><p>boolean, when <code>FALSE</code> full fits are discarded from memory -
reduces memory consumption and increases speed (when processing in parallel), but
prevents you from inspecting the fits and using <code><a href="recompute_SBC_statistics.html">recompute_SBC_statistics()</a></code>.
We recommend to set to <code>TRUE</code> in early phases of workflow, when you run just a few fits.
Once the model is stable and you want to run a lot of iterations, we recommend setting
to <code>FALSE</code> (even for quite a simple model, 1000 fits can easily exhaust 32GB of RAM).</p></dd>


<dt id="arg-thin-ranks">thin_ranks<a class="anchor" aria-label="anchor" href="#arg-thin-ranks"></a></dt>
<dd><p>how much thinning should be applied to posterior draws before computing
ranks for SBC. Should be large enough to avoid any noticeable autocorrelation of the
thinned draws See details below.</p></dd>


<dt id="arg-ensure-num-ranks-divisor">ensure_num_ranks_divisor<a class="anchor" aria-label="anchor" href="#arg-ensure-num-ranks-divisor"></a></dt>
<dd><p>Potentially drop some posterior samples to
ensure that this number divides the total number of SBC ranks (see Details).</p></dd>


<dt id="arg-chunk-size">chunk_size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>How many simulations within the <code>datasets</code> shall be processed in one batch
by the same worker. Relevant only when using parallel processing.
The larger the value, the smaller overhead there will be for parallel processing, but
the work may be distributed less equally across workers. We recommend setting this high
enough that a single batch takes at least several seconds, i.e. for small models,
you can often reduce computation time noticeably by increasing this value.
You can use <code>options(SBC.min_chunk_size = value)</code> to set a minimum chunk size globally.
See documentation of <code>future.chunk.size</code> argument for <code><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future.apply::future_lapply()</a></code> for more details.</p></dd>


<dt id="arg-dquants">dquants<a class="anchor" aria-label="anchor" href="#arg-dquants"></a></dt>
<dd><p>Derived quantities to include in SBC. Use <code><a href="derived_quantities.html">derived_quantities()</a></code> to construct them.</p></dd>


<dt id="arg-cache-mode">cache_mode<a class="anchor" aria-label="anchor" href="#arg-cache-mode"></a></dt>
<dd><p>Type of caching of results, currently the only supported modes are
<code>"none"</code> (do not cache) and <code>"results"</code> where the whole results object is stored
and recomputed only when the hash of the backend or dataset changes.</p></dd>


<dt id="arg-cache-location">cache_location<a class="anchor" aria-label="anchor" href="#arg-cache-location"></a></dt>
<dd><p>The filesystem location of cache. For <code>cache_mode = "results"</code>
this should be a name of a single file. If the file name does not end with
<code>.rds</code>, this extension is appended.</p></dd>


<dt id="arg-globals">globals<a class="anchor" aria-label="anchor" href="#arg-globals"></a></dt>
<dd><p>A list of names of objects that are defined
in the global environment and need to present for the backend to work (
if they are not already available in package).
It is added to the <code>globals</code> argument to <code><a href="https://future.futureverse.org/reference/future.html" class="external-link">future::future()</a></code>, to make those
objects available on all workers.</p></dd>


<dt id="arg-gen-quants">gen_quants<a class="anchor" aria-label="anchor" href="#arg-gen-quants"></a></dt>
<dd><p>Deprecated, use dquants instead</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An object of class <code><a href="SBC_results.html">SBC_results()</a></code>.</p>
    </div>
    <div id="paralellization">
    <h2>Paralellization</h2>
    <p>Parallel processing is supported via the <code>future</code> package, for most uses, it is most sensible
to just call <code>plan(multisession)</code> once in your R session and  all
cores your computer will be used. For more details refer to the documentation
of the <code>future</code> package.</p>
    </div>
    <div id="thinning">
    <h2>Thinning</h2>
    <p>When using backends based on MCMC, there are two possible moments when
draws may need to be thinned. They can be thinned directly within the backend
and they may be thinned only to compute the ranks for SBC as specified by the
<code>thin_ranks</code> argument. The main reason those are separate is that computing the
ranks requires no or negligible autocorrelation while some autocorrelation
may be easily tolerated for summarising the fit results or assessing convergence.
In fact, thinning too aggressively in the backend may lead to overly noisy
estimates of posterior means, quantiles and the <code><a href="https://mc-stan.org/posterior/reference/rhat.html" class="external-link">posterior::rhat()</a></code> and
<code><a href="https://mc-stan.org/posterior/reference/ess_tail.html" class="external-link">posterior::ess_tail()</a></code> diagnostics. So for well-adapted Hamiltonian Monte-Carlo
chains (e.g. Stan-based backends), we recommend no thinning in the backend and
even value of <code>thin_ranks</code> between 6 and 10 is usually sufficient to remove
the residual autocorrelation. For a backend based on Metropolis-Hastings,
it might be sensible to thin quite aggressively already in the backend and
then have some additional thinning via <code>thin_ranks</code>.</p>
<p>Backends that don't require thining should implement <code><a href="SBC_backend_iid_draws.html">SBC_backend_iid_draws()</a></code>
or <code><a href="SBC_backend_default_thin_ranks.html">SBC_backend_default_thin_ranks()</a></code> to avoid thinning by default.</p>
    </div>
    <div id="rank-divisors">
    <h2>Rank divisors</h2>
    <p>Some of the visualizations and post processing steps
we use in the SBC package (e.g. <code><a href="plot_rank_hist.html">plot_rank_hist()</a></code>, <code><a href="empirical_coverage.html">empirical_coverage()</a></code>)
work best if the total number of possible SBC ranks is a "nice" number
(lots of divisors).
However, the number of ranks is one plus the number of posterior samples
after thinning - therefore as long as the number of samples is a "nice"
number, the number of ranks usually will not be. To remedy this, you can
specify <code>ensure_num_ranks_divisor</code> - the method will drop at most
<code>ensure_num_ranks_divisor - 1</code> samples to make the number of ranks divisible
by <code>ensure_num_ranks_divisor</code>. The default 2 prevents the most annoying
pathologies while discarding at most a single sample.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Shinyoung Kim, Angie.H Moon, Martin Modrák, Teemu Säilynoja.</p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

<div class="pkgdown">
  <p></p><p>This site uses <a href="https://plausible.io" class="external-link">Plausible.io</a> for privacy-friendly web analytics (no cookies, no tracking).</p><p>Our stats are public at: <a href="https://plausible.io/hyunjimoon.github.io" class="external-link uri">https://plausible.io/hyunjimoon.github.io</a></p>
</div>

      </footer></div>






  </body></html>

