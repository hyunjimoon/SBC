<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SBC rank visualizations • SBC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SBC rank visualizations">
<meta property="og:description" content="SBC">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="hyunjimoon.github.io" src="https://plausible.io/js/script.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SBC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SBC.html">Get Started</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://mc-stan.org/rstan" class="external-link">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr" class="external-link">cmdstanr</a>
    </li>
    <li>
      <a href="http://paul-buerkner.github.io/brms/" class="external-link">brms</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm" class="external-link">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot" class="external-link">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan" class="external-link">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo" class="external-link">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred" class="external-link">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools" class="external-link">rstantools</a>
    </li>
    <li>
      <a href="https://mc-stan.org/posterior" class="external-link">posterior</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org" class="external-link">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/hyunjimoon/SBC" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SBC rank visualizations</h1>
                        <h4 data-toc-skip class="author">Martin
Modrák</h4>
            
            <h4 data-toc-skip class="date">2025-08-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hyunjimoon/SBC/blob/HEAD/vignettes/rank_visualizations.Rmd" class="external-link"><code>vignettes/rank_visualizations.Rmd</code></a></small>
      <div class="hidden name"><code>rank_visualizations.Rmd</code></div>

    </div>

    
    
<p>This vignette aims to explain how to interpret various visualizations
of the main results of SBC: the posterior ranks. If the model +
algorithm works correctly, the posterior ranks of the prior draws should
be distributed uniformly. While one could test for this uniformity
numerically via some sort of statistical test, it is often more
informative to look at visualizations that not only tell us whether a
problem appears, but what kind of problem and how severe it is.</p>
<p>In this vignette, we’ll first explain each of the visualizations
individually and then show them side-by-side for the same
configuration.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hyunjimoon.github.io/SBC/">SBC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="simulation-setup">Simulation setup<a class="anchor" aria-label="anchor" href="#simulation-setup"></a>
</h2>
<p>We’ll use the built-in example that simulates ranks using a known
correct distribution and a specific distribution that is actually
observed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">22654885</span><span class="op">)</span></span>
<span><span class="va">res_50</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SBC_example_results.html">SBC_example_results</a></span><span class="op">(</span><span class="st">"visualizations"</span>, n_sims <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="co"># The example results have this extra attribute showing analytic densities,</span></span>
<span><span class="co"># this is not a part of normal SBC results</span></span>
<span><span class="va">density_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res_50</span>, <span class="st">"density_df"</span><span class="op">)</span> </span></code></pre></div>
<p>This is how the corresponding analytical densities look like - in the
“Exact match” case they overlap and SBC should pass, in all other cases
it should signal issues.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_density_comparison</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">density_df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">density_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">density</span>, color <span class="op">=</span> <span class="va">type</span>, linewidth <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">density_df</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"Correct"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">density_df</span>, <span class="va">type</span> <span class="op">==</span> <span class="st">"Observed"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span><span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Correct"</span> <span class="op">=</span> <span class="st">"skyblue1"</span>, </span>
<span>                                    <span class="st">"Observed"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linewidth_manual</a></span><span class="op">(</span><span class="st">""</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Correct"</span> <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                                    <span class="st">"Observed"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_density_comparison</span><span class="op">(</span><span class="va">density_df</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/densities-1.png" width="700"></p>
<p>Now let’s look how these issues manifest in various plots:</p>
</div>
<div class="section level2">
<h2 id="plot_rank_hist---the-rank-histogram">
<code>plot_rank_hist</code> - The rank histogram<a class="anchor" aria-label="anchor" href="#plot_rank_hist---the-rank-histogram"></a>
</h2>
<p>Rank histogram is probably the simplest of the visualizations. We
plot a histogram of the ranks and look if all bins are roughly equally
represented. The expected average count is shown as a horizontal black
line, and an approximate interval highlighting expected deviations (by
default 95%) is shown as the light blue wedged rectangle in the
background.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_rank_hist.html">plot_rank_hist</a></span><span class="op">(</span><span class="va">res_50</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/rank_hist_50_default-1.png" width="700"></p>
<p>The two main disadvantages of this plot are:</p>
<ol style="list-style-type: decimal">
<li>Since the confidence interval is only approximate, it cannot be
taken too seriously. However, gross violations are still immediately
visible.</li>
<li>It is sensitive to the choice of number of bins. There is a tradeoff
in that more bins mean more resolution, but less power to detect some
violations of uniformity. Additionally, one needs to be mindful of the
total number of ranks as the number of bins should preferably divide the
number of ranks.</li>
</ol>
<p>This is the reason why the “Some extra-low estimates” case is not
visible with the default number of bins - the extra low estimates (and
thus high ranks) get smoothed by being combined into a wider bin. We can
plot the same results but with the maximum number of bins (100, as the
ranks in our case range from 0 to 99):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_rank_hist.html">plot_rank_hist</a></span><span class="op">(</span><span class="va">res_50</span>, bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/rank_hist_50_100-1.png" width="700"></p>
<p>This lets us see something suspicious for the “Some extra-low
estimates” case, but we’ve increased noise overall and the other
patterns become harder to see.</p>
<p>Additionally, if the number of bins does not divide the total number
of ranks (here 100) neatly, some bins are expected to get slightly more
ranks than others. The plot compensates for this by extending the
confidence interval to cover both cases, resulting in some loss of
precision - here a particularly bad choice of the number of bins
obscures problems in “Model too uncertain” and “Some extra-low
estimates”.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_rank_hist.html">plot_rank_hist</a></span><span class="op">(</span><span class="va">res_50</span>, bins <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/rank_hist_50_17-1.png" width="700"></p>
<p>Choice of number of bins obviously becomes less of a problem, if we
have a large number of simulations. With 1000 simulations, the patterns
are clear and unmistakable.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SBC_example_results.html">SBC_example_results</a></span><span class="op">(</span><span class="st">"visualizations"</span>, n_sims <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_rank_hist.html">plot_rank_hist</a></span><span class="op">(</span><span class="va">res_1000</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/rank_hist_1000-1.png" width="700"></p>
<p>We should also note that since we are essentially performing many
comparisons, seeing a low number of “failures” in some bins is to be
expected and does not necessarily signal a problem - in the plot above
the “Exact match” case has several bins outside of the approximate
confidence interval.</p>
</div>
<div class="section level2">
<h2 id="plot_ecdf-and-plot_ecdf_diff---ecdf-plots">
<code>plot_ecdf</code> and <code>plot_ecdf_diff</code> - ECDF
plots<a class="anchor" aria-label="anchor" href="#plot_ecdf-and-plot_ecdf_diff---ecdf-plots"></a>
</h2>
<p>These two related plots remedy the main problems of the rank
histogram - they do not depend on any binning and provide exact
confidence intervals. The ECDF plot shows the empirical cumulative
distribution function (ECDF). If ranks were perfectly uniform, this
would be a “diagonal staircase”, but some deviations from exact
uniformity are to be expected. The ECDF plot shows aN ellipse outlining
the expected deviations (by default at the 95% level). It looks like
this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ECDF-plots.html">plot_ecdf</a></span><span class="op">(</span><span class="va">res_50</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/ecdf_50-1.png" width="700"></p>
<p>A minor problem with this visualization is that the top-left and
bottom-right parts of the plot are usually left unused and as the number
of simulations grows, it may become hard to discern details in the
center. Let us look at the same plot from 1000 simulations:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ECDF-plots.html">plot_ecdf</a></span><span class="op">(</span><span class="va">res_1000</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/ecdf_1000-1.png" width="700"></p>
<p>Now it gets a bit hard to see, whether the “Exact match” case is well
within the ellipse or rather hitting the boundaries.</p>
<p>The ECDF diff plot shows exactly the same information as the ECDF
plot, but looks not at the ECDF itself, but rather on the
<em>difference</em> between the perfectly uniform CDF and the ECDF. In
other words, it rotates the ECDF plot by 45 degrees to the right to make
the uniform CDF a flat line:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ECDF-plots.html">plot_ecdf_diff</a></span><span class="op">(</span><span class="va">res_1000</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/ecdf_diff_1000-1.png" width="700"></p>
<p>Now, we get a much increased resolution for the “Exact match” case.
Also note that in the rank histogram the “Some extra-low estimates” case
showed only as a failure in the highest ranks. However, the ECDF and
ECDF diff plots also show how the slight under-abundance of the low
ranks - which is not noticeable when looking at each rank / rank bin
individually - slowly adds up and by 50th percentile we already see a
problem.</p>
<p>The ECDF diff plot usually looks better than the ECDF plot even with
lower number of simulations and is thus preferable to ECDF in most
cases:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ECDF-plots.html">plot_ecdf_diff</a></span><span class="op">(</span><span class="va">res_50</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/ecdf_diff_50-1.png" width="700"></p>
<p>A downside of the ECDF and especially the ECDF diff plot is that the
connection between the shape seen in the plot and the type of the
failure is less straightforward.</p>
</div>
<div class="section level2">
<h2 id="plot_coverage-and-plot_coverage_diff---empirical-coverage">
<code>plot_coverage</code> and <code>plot_coverage_diff</code> -
Empirical coverage<a class="anchor" aria-label="anchor" href="#plot_coverage-and-plot_coverage_diff---empirical-coverage"></a>
</h2>
<p>The rank histogram and both ECDF plots are useful for noticing that
there is a problem in the model and what type of mismatch are we seeing.
However, it is a bit harder to interpret how bad the failures actually
are for inference and how large problems could still be unnoticed
because we ran too few simulations.</p>
<p>The empirical coverage tries to help with that. It builds on the
<code><a href="../reference/empirical_coverage.html">empirical_coverage()</a></code> function and by default shows the
coverage of the central posterior credible intervals (coverage is the
proportion of true variable values that fall within the interval). A
well working model would have coverage exactly match interval width
(i.e. 95% credible interval contains the true value 95% of the time) as
shown by the blue line. The focus on central intervals is often more
relevant to inference than the leftmost intervals implied in the ECDF
plots. The coverage is accompanied by approximate credible intervals for
the coverage (gray).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_coverage.html">plot_coverage</a></span><span class="op">(</span><span class="va">res_50</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/coverage_50-1.png" width="700"></p>
<p>This lets us neatly see that with 50 simulations, we still cannot
rule even relatively large miscalibration in the “Exact match” case
where e.g. the 50% central interval could still contain about 70% of the
true values. A downside of the focus on central intervals is that
underestimation and overestimation now produce the same overall shape in
the plot.</p>
<p>For similar reasons as with the ECDF plot, there is also “difference”
version of the plot that takes the <em>differences</em> in coverage into
focus.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_coverage.html">plot_coverage_diff</a></span><span class="op">(</span><span class="va">res_50</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/coverage_diff_50-1.png" width="700"></p>
<p>In the example here, all the problematic scenarios manifest also as
problems on the empirical coverage plot. However, empirical coverage,
especially for the central intervals has some notable limitations as a
diagnostic and thus should always be complemented by a rank histogram /
ECDF plot - see <code><a href="../reference/empirical_coverage.html">help(empirical_coverage)</a></code> for some
additional details.</p>
</div>
<div class="section level2">
<h2 id="side-by-side-comparison">Side by side comparison<a class="anchor" aria-label="anchor" href="#side-by-side-comparison"></a>
</h2>
<p>To let us better understand how the various plots relate, we will
know plot the scenarios one by one, showing all plots for the same
scenario side-by-side.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_side_by_side</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">res</span>, <span class="va">var</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">legend_bottom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>                         legend.direction <span class="op">=</span> <span class="st">"vertical"</span>,</span>
<span>                         legend.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t<span class="op">=</span><span class="op">-</span><span class="fl">1</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span></span>
<span>                         <span class="op">)</span></span>
<span>  <span class="co"># Hack - use variable name to show plot type</span></span>
<span>  <span class="va">density_df_to_plot</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">density_df</span>, <span class="va">variable</span> <span class="op">==</span> <span class="va">var</span><span class="op">)</span></span>
<span>  <span class="va">density_df_to_plot</span><span class="op">$</span><span class="va">variable</span> <span class="op">&lt;-</span> <span class="st">"Densities"</span></span>
<span>  </span>
<span>  <span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">stats</span>, <span class="va">variable</span> <span class="op">==</span> <span class="va">var</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">p_dens</span> <span class="op">&lt;-</span> <span class="fu">plot_density_comparison</span><span class="op">(</span><span class="va">density_df_to_plot</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="va">legend_bottom</span></span>
<span>  <span class="va">p_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_rank_hist.html">plot_rank_hist</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">stats</span>, variable <span class="op">=</span> <span class="st">"Rank histogram"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">p_ecdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ECDF-plots.html">plot_ecdf</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">stats</span>, variable <span class="op">=</span> <span class="st">"ECDF"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">legend_bottom</span></span>
<span>  <span class="va">p_ecdf_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ECDF-plots.html">plot_ecdf_diff</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">stats</span>, variable <span class="op">=</span> <span class="st">"ECDF diff"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">legend_bottom</span></span>
<span>  <span class="va">p_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coverage.html">plot_coverage</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">stats</span>, variable <span class="op">=</span> <span class="st">"Coverage"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">p_coverage_diff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_coverage.html">plot_coverage_diff</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">stats</span>, variable <span class="op">=</span> <span class="st">"Coverage diff"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">p_dens</span>  <span class="op">+</span> <span class="va">p_ecdf</span> <span class="op">+</span> <span class="va">p_ecdf_diff</span> <span class="op">+</span> <span class="va">p_rank</span> <span class="op">+</span> <span class="va">p_coverage</span> <span class="op">+</span> <span class="va">p_coverage_diff</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html" class="external-link">plot_annotation</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We will start with the “Exact match” (i.e. no problem) scenario with
50 simulations.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_side_by_side</span><span class="op">(</span><span class="va">res_50</span>, <span class="st">"Exact match"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/side_by_side_50_exact_match-1.png" width="700"></p>
<p>The relative utility of the <code>_diff</code> versions of the plots
changes if we have more simulations:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_side_by_side</span><span class="op">(</span><span class="va">res_1000</span>, <span class="st">"Exact match"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/side_by_side_1000_exact_match-1.png" width="700"></p>
<p>If the model is too certain, it will have over-abundance of extreme
ranks and lower than expected coverage. Note also that since we are
looking at central intervals, the discrepancies in the lower and upper
tail combine to produce a large discrepancy on the coverage plot,
although the discrepancy on the ECDF plot is modest.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_side_by_side</span><span class="op">(</span><span class="va">res_50</span>, <span class="st">"Model too certain"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/side_by_side_50_too_certain-1.png" width="700"></p>
<p>If the model is overly uncertain, it will have overabundance of
central ranks (and too few extreme ranks) and the coverage will be
higher than expected. Similarly to the previous case, the discrepancies
in the lower and upper tail combine to produce a large discrepancy on
the coverage plot, although the discrepancy on the ECDF plot is barely
visible.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_side_by_side</span><span class="op">(</span><span class="va">res_50</span>, <span class="st">"Model too uncertain"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/side_by_side_50_too_uncertain-1.png" width="700"></p>
<p>If the model is underestimating, we will see too many high ranks and
coverage will be lower than expected.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_side_by_side</span><span class="op">(</span><span class="va">res_50</span>, <span class="st">"Model underestimating"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/side_by_side_50_underest-1.png" width="700"></p>
<p>If the model is overestimating we will see too many low ranks, while
the effect on central interval coverage will be similar to
underestimation and the coverage will be lower than expected.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plot_side_by_side</span><span class="op">(</span><span class="va">res_50</span>, <span class="st">"Model overestimating"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rank_visualizations_files/figure-html/side_by_side_50_overest-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Shinyoung Kim, Angie.H Moon, Martin Modrák, Teemu Säilynoja.</p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>This site uses <a href="https://plausible.io" class="external-link">Plausible.io</a> for privacy-friendly web analytics (no cookies, no tracking).</p>
<p>Our stats are public at: <a href="https://plausible.io/hyunjimoon.github.io" class="external-link uri">https://plausible.io/hyunjimoon.github.io</a></p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
